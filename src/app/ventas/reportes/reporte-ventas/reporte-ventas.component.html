<div class="container mat-elevation-z2 p-3">
  <div class="mb-3">
  <button mat-stroked-button color="warn" (click)="regresarVentas()">
    <mat-icon>arrow_back</mat-icon>
    Regresar a Ventas
  </button>
</div>

  <h2>Reporte de Ventas</h2>

  <div class="row mb-3">
    <div class="col">
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Tipo de reporte</mat-label>
        <mat-select [(value)]="tipoReporte">
          <mat-option value="mensual">Mensual</mat-option>
          <mat-option value="semanal">Semanal</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="col">
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Año</mat-label>
        <input matInput type="number" [(ngModel)]="year">
      </mat-form-field>
    </div>

    <div class="col" *ngIf="tipoReporte === 'mensual'">
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Mes</mat-label>
        <input matInput type="number" min="1" max="12" [(ngModel)]="month">
      </mat-form-field>
    </div>

    <div class="col" *ngIf="tipoReporte === 'semanal'">
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Semana</mat-label>
        <input matInput type="number" min="1" max="52" [(ngModel)]="week">
      </mat-form-field>
    </div>

    <div class="col d-flex align-items-end">
      <button mat-raised-button color="primary" (click)="getReporte()">
        <mat-icon>filter_alt</mat-icon>
        Filtrar
      </button>
    </div>
  </div>

  <button mat-raised-button color="primary" class="mb-3"
        (click)="exportPDF()"
        [disabled]="!reporte.Ventas.length">
    <mat-icon>picture_as_pdf</mat-icon>
    Exportar PDF
  </button>

  <div *ngIf="reporte" class="mb-3 totales">
  <span>Total de Ventas: {{ reporte.TotalVentas }}</span>
  <span class="separator">|</span>
  <span>Total Ingresos: {{ reporte.TotalIngresos | currency:'MXN':'symbol':'1.2-2' }}</span>
</div>


  <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

  <table mat-table [dataSource]="dataSource" class="mat-elevation-z1 w-100"
       *ngIf="dataSource.data.length > 0">

    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef>ID</th>
      <td mat-cell *matCellDef="let v">{{v.VentaId}}</td>
    </ng-container>

    <ng-container matColumnDef="cliente">
      <th mat-header-cell *matHeaderCellDef>Cliente</th>
      <td mat-cell *matCellDef="let v">{{v.Cliente}}</td>
    </ng-container>

    <ng-container matColumnDef="metodoPago">
      <th mat-header-cell *matHeaderCellDef>Método de Pago</th>
      <td mat-cell *matCellDef="let v">{{v.MetodoPago}}</td>
    </ng-container>

    <ng-container matColumnDef="fecha">
      <th mat-header-cell *matHeaderCellDef>Fecha</th>
      <td mat-cell *matCellDef="let v">{{v.Fecha | date:'dd/MM/yyyy'}}</td>
    </ng-container>

    <ng-container matColumnDef="total">
      <th mat-header-cell *matHeaderCellDef>Total</th>
      <td mat-cell *matCellDef="let v">{{v.Total | currency:'MXN':'symbol':'1.2-2'}}</td>
    </ng-container>

    <ng-container matColumnDef="estado">
      <th mat-header-cell *matHeaderCellDef>Estado</th>
      <td mat-cell *matCellDef="let v">{{v.Estado}}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

  </table>

  <mat-card *ngIf="!reporte.Ventas.length" class="mt-4 p-4 text-center">
    <p>No hay ventas registradas para este periodo.</p>
  </mat-card>

</div>
