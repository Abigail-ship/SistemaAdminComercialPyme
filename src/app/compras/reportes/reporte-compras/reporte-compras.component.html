<div class="container mat-elevation-z2 p-3">
  <button mat-raised-button class="btn-back" (click)="goToCompras()">
  <mat-icon>arrow_back</mat-icon>
  Regresar a Compras
</button>

  <h2>Reporte de Compras</h2>

  <!-- 游늷 Selecci칩n de tipo de reporte y periodo -->
  <div class="row mb-3">

    <div class="col">
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Tipo de reporte</mat-label>
        <mat-select [(value)]="tipoReporte">
          <mat-option value="mensual">Mensual</mat-option>
          <mat-option value="semanal">Semanal</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="col">
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>A침o</mat-label>
        <input matInput type="number" [(ngModel)]="year">
      </mat-form-field>
    </div>

    <div class="col" *ngIf="tipoReporte === 'mensual'">
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Mes</mat-label>
        <input matInput type="number" min="1" max="12" [(ngModel)]="month">
      </mat-form-field>
    </div>

    <div class="col" *ngIf="tipoReporte === 'semanal'">
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Semana</mat-label>
        <input matInput type="number" min="1" max="52" [(ngModel)]="week">
      </mat-form-field>
    </div>

    <!-- 游늷 Bot칩n Filtrar -->
    <div class="col d-flex align-items-end">
      <button mat-raised-button color="primary" (click)="getReporte()">
        <mat-icon>filter_alt</mat-icon>
        Filtrar
      </button>
    </div>

  </div>

  <!-- 游늷 Bot칩n para generar PDF -->
  <button mat-raised-button color="primary" class="mb-3"
        (click)="exportPDF()"
        [disabled]="!reporte.Compras.length">
    <mat-icon>picture_as_pdf</mat-icon>
    Exportar PDF
  </button>

  <!-- 游늷 Total del periodo -->
  <div *ngIf="reporte" class="mb-3">
    <strong>Total de Compras:</strong><span> {{ reporte.TotalCompras }} </span>|
    <strong>Total Gastado:</strong><span> {{ reporte.TotalGastado | currency:'MXN':'symbol':'1.2-2' }}</span>
  </div>

  <!-- 游늷 Barra de carga -->
  <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

  <!-- 游늷 Tabla de compras -->
  <table mat-table [dataSource]="dataSource" class="mat-elevation-z1 w-100"
       *ngIf="dataSource.data.length > 0">

    <!-- Columnas -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef>ID</th>
      <td mat-cell *matCellDef="let c">{{c.CompraId}}</td>
    </ng-container>

    <ng-container matColumnDef="proveedor">
      <th mat-header-cell *matHeaderCellDef>Proveedor</th>
      <td mat-cell *matCellDef="let c">{{c.Proveedor}}</td>
    </ng-container>

    <ng-container matColumnDef="fecha">
      <th mat-header-cell *matHeaderCellDef>Fecha</th>
      <td mat-cell *matCellDef="let c">{{c.Fecha | date:'dd/MM/yyyy'}}</td>
    </ng-container>

    <ng-container matColumnDef="total">
      <th mat-header-cell *matHeaderCellDef>Total</th>
      <td mat-cell *matCellDef="let c">{{c.Total | currency:'MXN':'symbol':'1.2-2'}}</td>
    </ng-container>

    <ng-container matColumnDef="estado">
      <th mat-header-cell *matHeaderCellDef>Estado</th>
      <td mat-cell *matCellDef="let c">{{c.Estado}}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

  </table>

  <!-- 游늷 Mensaje si no hay datos -->
  <mat-card *ngIf="!reporte.Compras.length" class="mt-4 p-4 text-center">
    <p>No hay compras registradas para este periodo.</p>
  </mat-card>

</div>
